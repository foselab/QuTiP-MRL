from qutip_mrl.qudit_circuit import QuditCircuit

demultiplexer = QuditCircuit(num_qudit=15)

demultiplexer.plus1(target=0)
demultiplexer.c_feynman_2(A=0, B=2, C=4)
demultiplexer.plus1(target=0)
demultiplexer.c_feynman_2(A=0, B=2, C=3)
demultiplexer.plus1(target=0)
demultiplexer.c_feynman_2(A=0, B=2, C=5)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=3, C=7)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=3, C=6)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=3, C=8)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=4, C=10)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=4, C=9)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=4, C=11)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=5, C=13)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=5, C=12)
demultiplexer.plus1(target=1)
demultiplexer.c_feynman_2(A=1, B=5, C=14)

demultiplexer.draw()

'''
OUTPUT:
           +----+                                            +----+                                            +----+                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
Q0   ------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
           +----+                |                   |       +----+                |                   |       +----+                |                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                 |                   |                             |                   |                             |                   |       +----+                                            +----+                                            +----+                                            +----+                                            +----+                                            +----+                                            +----+                                            +----+                                            +----+                                          
Q1   ----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-------| +1 |----------------O-------------------O-----
                                 |                   |                             |                   |                             |                   |       +----+                |                   |       +----+                |                   |       +----+                |                   |       +----+                |                   |       +----+                |                   |       +----+                |                   |       +----+                |                   |       +----+                |                   |       +----+                |                   |     
                               +----+              +----+                        +----+              +----+                        +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |     
Q2   ------------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----
                       |       +----+      |       +----+                |       +----+      |       +----+                |       +----+      |       +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |     
                       |                   |                           +----+              +----+                          |                   |                                     +----+              +----+                        +----+              +----+                        +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |     
Q3   ------------------|-------------------|---------------------------| +2 |--------------| +1 |--------------------------|-------------------|-----------------------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----
                       |                   |                           +----+              +----+                          |                   |                             |       +----+      |       +----+                |       +----+      |       +----+                |       +----+      |       +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |     
                     +----+              +----+                                                                            |                   |                             |                   |                             |                   |                             |                   |                                     +----+              +----+                        +----+              +----+                        +----+              +----+                          |                   |                             |                   |                             |                   |     
Q4   ----------------| +2 |--------------| +1 |----------------------------------------------------------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----
                     +----+              +----+                                                                            |                   |                             |                   |                             |                   |                             |                   |                             |       +----+      |       +----+                |       +----+      |       +----+                |       +----+      |       +----+                          |                   |                             |                   |                             |                   |     
                                                                                                                         +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                                     +----+              +----+                        +----+              +----+                        +----+              +----+  
Q5   --------------------------------------------------------------------------------------------------------------------| +2 |--------------| +1 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |----------------O-------| 12 |------O-------| 12 |--
                                                                                                                         +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |       +----+      |       +----+                |       +----+      |       +----+                |       +----+      |       +----+  
                                                                                                                                                                             |                   |                           +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |               
Q6   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------|---------------------------| +2 |--------------| +1 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|---------------
                                                                                                                                                                             |                   |                           +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |               
                                                                                                                                                                           +----+              +----+                                                                            |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |               
Q7   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------| +2 |--------------| +1 |----------------------------------------------------------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|---------------
                                                                                                                                                                           +----+              +----+                                                                            |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |               
                                                                                                                                                                                                                                                                               +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |               
Q8   --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| +2 |--------------| +1 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|---------------
                                                                                                                                                                                                                                                                               +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |                             |                   |                             |                   |               
                                                                                                                                                                                                                                                                                                                                   |                   |                           +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |               
Q9   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------|---------------------------| +2 |--------------| +1 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|---------------
                                                                                                                                                                                                                                                                                                                                   |                   |                           +----+              +----+                          |                   |                             |                   |                             |                   |                             |                   |               
                                                                                                                                                                                                                                                                                                                                 +----+              +----+                                                                            |                   |                             |                   |                             |                   |                             |                   |               
Q10  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| +2 |--------------| +1 |----------------------------------------------------------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|---------------
                                                                                                                                                                                                                                                                                                                                 +----+              +----+                                                                            |                   |                             |                   |                             |                   |                             |                   |               
                                                                                                                                                                                                                                                                                                                                                                                                                                     +----+              +----+                          |                   |                             |                   |                             |                   |               
Q11  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| +2 |--------------| +1 |--------------------------|-------------------|-----------------------------|-------------------|-----------------------------|-------------------|---------------
                                                                                                                                                                                                                                                                                                                                                                                                                                     +----+              +----+                          |                   |                             |                   |                             |                   |               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                   |                           +----+              +----+                          |                   |               
Q12  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------|---------------------------| +2 |--------------| +1 |--------------------------|-------------------|---------------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                   |                           +----+              +----+                          |                   |               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +----+              +----+                                                                            |                   |               
Q13  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| +2 |--------------| +1 |----------------------------------------------------------------------------|-------------------|---------------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +----+              +----+                                                                            |                   |               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +----+              +----+            
Q14  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| +2 |--------------| +1 |------------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           +----+              +----+            
'''

demultiplexer.simulate_einsum()

'''
OUTPUT:

QUDIT 0 state probabilities:
  1
  0
  0
QUDIT 1 state probabilities:
  1
  0
  0
QUDIT 2 state probabilities:
  1
  0
  0
QUDIT 3 state probabilities:
  1
  0
  0
QUDIT 4 state probabilities:
  1
  0
  0
'''

demultiplexer.simulate_fullmatrix()

'''
OUTPUT:

Not working for large circuits
'''

